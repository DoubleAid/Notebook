# 11 回环检测

## 主要目标

1. 理解回环检测的必要性
2. 掌握基于词袋的外观式回环检测
3. 通过DBow3的实验，学习词袋模型的实际用途

我们知道SLAM主体（前端和后端）主要的目的在于估计相机运动，而回环检测模块，无论是目标上和方法上，都与前面的内容相差很大

## 回环检测的意义

前端提供特征点的提取和轨迹，地图的初值
后端负责对所有这些数据进行优化

如果像VO 这样仅考虑相邻时间的关联，那么误差将会不断的累积，使得整个SLAM出现累积误差，长期估计将不可靠

回环检测能够给出了相邻帧之外更加久远的约束，例如x_1 到 x_100 之间的位姿变换，当两者经过了同一个地方

如果能够成功检测，就可以为后端的位姿图提供更多的有效数据，从而得到一个全局一致的估计

1. 它关系到我们估计的轨迹和地图在长时间下的正确性
2. 回环检测提供了当前数据与所有历史数据的关联
3. 在跟踪算法丢失后，我们还可以利用回环检测进行重定位

我们有时候把仅有前端和局部后端的系统称为VO，而把带有回环检测和全局后端的系统称为SLAM

## 回环检测的实现

最简单的方法就是对任意两幅图像都作一遍特征匹配，根据正确匹配的数量确定哪两幅图存在关联---这确实是一种朴素且又掉的思想
缺点在于，我们盲目的假设任意两幅图都可能存在回环，使得检测的数量太大了

上面的思路太过粗糙，我们至少希望有一个哪里可能出现回环的预计

+ 第一种：基于里程计的几何关系
+ 第二种：基于外观

基于几何关系就是说，当我们的相机运动到了之前的某个位置附近，检测他们之间有没有回环，这种方法的缺点是，如果相机运动的轨迹比较复杂，那么这种检测的准确性就会降低
而且，由于存在累积误差，往往没法正确的发现运动到了之前的某个位置

第二种是基于外观，他和前后端都无关，根据两幅图的相似性确定回环检测关系，这种方法摆脱了累积误差，使得回环检测模块称为相对独立的模块
那么基于外观的回环检测算法中，核心的问题就变成了如何计算图像间的相似性。直接进行灰度的检测是不行的，无论是角度的转变，光照强度的转变，都会使得灰度值发生变化

### 准确率和召回率

