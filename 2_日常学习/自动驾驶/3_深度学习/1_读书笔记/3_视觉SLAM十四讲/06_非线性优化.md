# 非线性优化

## 主要目标

1. 理解最小二乘法的含义和处理方式
2. 理解高斯牛顿法，列文伯格-马夸尔特方法等下降策略

由前面已经知道，方程中的位姿可以由变换矩阵来描述，然后用李代数进行优化，观测方程由相机成像模型给出，内参是固定的，外参是相机的位姿

由于噪声的存在，上面所说的等式必定不是准确的，而是近似等式，因此需要对误差进行最小化，从而得到最优的位姿估计

## 状态估计问题

首先回顾一下经典SLAM模型，由一个状态方程和一个运动方程构成

$$
x_k = f(x_{k-1}, u_k) + w_k
z_{k, j} = h(y_j, x_k) + v_{k, j}
$$

这里的$x_k$ 是相机的位姿，我们可以使用变换矩阵或者李代数来表示，至于观测方程，也就是针孔相机模型，这里将讨论其具体的参数化形式

假设在 $x_k$ 处对路标 $y_j$ 进行了一次观测，对应到图像上的像素位置 $Z_{k,j}$ 那么观测方程为

$$
sZ_{k,j} = Kx_ky_j = Kexp(\theta_{\times})y_j
$$

其中，K为相机内参，s为单位像素的长度

数据受噪音影响后，在运动和观测方程中，通常假设两个噪声项 $W_k, V_kj$ 分别服从高斯分布，即

$$
w_k ～ N(0, R_k), v_k ～ N(0, Q_{k, j})
$$

在这些噪音的影响下，我们希望通过带噪音的数据z和u推断位姿x和地图y （以及他们的概率分布）这构成了一个状态估计问题

由于这些数据是随着时间逐渐到来的，所以在历史上很长一段时间内，研究者都是用滤波器，尤其是扩展卡尔曼滤波器（EKF）求解，

卡尔曼滤波器关心当前时刻的状态估计 $x_k$, 而对之前的状态则不多考虑
近些年来普遍使用的非线性优化方法，使用所有时刻采集到的数据进行状态估计，被认为优于传统的滤波器，也是当前视觉SLAM的主流方法

首先，在非线性优化中，把所有带估计的变量放在一个 "状态变量" 中

$x = {x_1, ..., x_N, y_1, ..., y_M}$

对机器人状态的估计，就是已知输入数据u和观测数据z的条件下，求计算状态x的条件概率分布

$$
P(x | z, u)
$$

类似于x，这里的u和z也是对所有数据的统称

对于没有测量运动的传感器，且不考虑图像在时间上的联系，只看图片(只要图片足够多) 就可以