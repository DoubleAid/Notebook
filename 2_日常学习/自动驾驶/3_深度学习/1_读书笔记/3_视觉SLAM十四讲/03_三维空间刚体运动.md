# 第三讲 三维空间刚体运动

## 主要目标

1. 理解三维空间的刚体运动描述方式：旋转矩阵，变换矩阵，四元数和欧拉角
2. 掌握Eigen库的矩阵，几何2模块的使用方法

## 旋转矩阵

在三位空间内使用三个轴的坐标来标识位置，一般情况下使用右手定则，z轴方向由 x X y 右手定则确定

接下来介绍两个运算方式

内积：两个向量的点积，计算公式为 $a \cdot b = a_x b_x + a_y b_y + a_z b_z = |a||b|cos(a,b)$

内积可以描述为向量间的投影关系

外积：两个向量的叉积，计算公式为 

$a \times b = (a_y b_z - a_z b_y, a_z b_x - a_x b_z, a_x b_y - a_y b_x) = \begin{bmatrix}
i & j & k \\
a_1 & a_2 & a_3 \\
b_1 & b_2 & b_3
\end{bmatrix}$ = $\begin{bmatrix}
a_2b_3 - a_3b_2 \\
a_3b_1 - a_1b_3 \\
a_1b_2 - a_2b_1
\end{bmatrix}$ = $\begin{bmatrix}
0 & -a_3 & a_2 \\
a_3 & 0 & -a_1 \\
-a_2 & a_1 & 0
\end{bmatrix}b$ = a^b

外积的方向垂直于这两个向量，大小为 |a||b|sin(a, b) 是这两个向量组成的矩阵的面积

把a写成一个矩阵，成为反对称矩阵（Skew-symmetric）

外积只对三位向量存在定义，我们还能用外积标识向量的旋转

考虑两个不平行的向量a和b，它们的外积c = a^b，c的方向垂直于a和b，大小为 |a||b|sin(a, b)，c的大小可以看作是a和b之间的夹角的正弦值，c的方向可以看作是a和b之间的夹角的正弦值的方向

### 坐标系件的欧式变换

相机运动是一个刚体运动，它保证同一个向量在各个坐标系下的长度和角度不会发生改变，称之为欧式变换

与向量的旋转类似，同样可以描述两个坐标系之间的旋转关系，再加上平移，统称为坐标系之间的变换关系，

通常情况下设定一个惯性坐标系（或者叫世界坐标系）作为参考系，认定其位置不变
同时机器人的坐标系是一个移动坐标系，其位置会随着机器人的运动而改变

假设相机视野中有一个点，其坐标为Pc，在世界坐标系下的坐标为Pw，这两个坐标之间是如何转换的呢

首先，假设相机的坐标系相对于世界坐标系有一个旋转矩阵R，以及一个平移向量T

先来考虑旋转，某一个单位的正交基 $(e_1,e_2,e_3)$ 经过一次旋转变成了 $(e^,_1, e^,_1, e^,_1)$
那么对弈同一个向量a（注意盖向量并没有随着坐标系的旋转而发生运动），它在两个坐标系下的坐标为 $[a_1,a_2,a_3]^T$ 和 $[a^,_1, a^,_1, a^,_1]^T$

它在两个坐标系之间的转换为

$$
[e_1,e_2,e_3]
\begin{bmatrix}
a_1 \\
a_2 \\
a_3
\end{bmatrix}
= [e^,_1, e^,_1, e^,_1]
\begin{bmatrix}
a_1^, \\
a_2^, \\
a_3^,
\end{bmatrix}
$$

如果同时左右两边同时左乘以 $\begin{bmatrix}
e_1^T \\
e_2^T \\
e_3^T
\end{bmatrix}$，左边就变成了单位矩阵（因为e是单元基，自己的内积为单位长），所以：

$$
\begin{bmatrix}
a_1 \\
a_2 \\
a_3
\end{bmatrix}
= \begin{bmatrix}
e_1^Te_1^, & e_1^Te_2^, & e_1^Te_3^, \\
e_2^Te_1^, & e_2^Te_2^, & e_2^Te_3^, \\
e_3^Te_1^, & e_3^Te_2^, & e_3^Te_3^,
\end{bmatrix}
\begin{bmatrix}
a_1^, \\
a_2^, \\
a_3^,
\end{bmatrix}
=Ra^,
$$

我们把中间的矩阵拿出来，定义为矩阵R，这个矩阵由两组基之间的内积组成，刻画了旋转旋转前后同一个向量的坐标转换关系。所以说矩阵R描述了旋转本身，称为旋转矩阵

旋转矩阵由一些性质

+ 他是一个行列式为1的蒸饺矩阵 <==> 行列式为1的正交矩阵也是一个旋转矩阵

所以把旋转矩阵的集合定义为

$$
SO{n} = \{ R \in \mathbb{R}^{3 \times 3} \mid R^T R = I, \det(R) = 1 \}
$$

SO(n) 是特殊正交群，n=3，表示三维空间的旋转矩阵

由于旋转矩阵为正交矩阵，他的逆（即转置）描述了一个相反的旋转

$$
a^, = R^{-1}a = R^Ta
$$

在欧式变换中，除了旋转还有平移，，将其拼合在一起就变成了

$$
a^, = Ra + t
$$

t 称为平移向量，相比于旋转，平移部分只需要将这个平移量加到旋转后的坐标

但这个公式并不满足线性变换的性质，因为平移部分不满足线性变换的性质，所以需要引入一个额外的维度，将平移向量变成一个四维向量

$$
\begin{bmatrix}
a^, \\
1
\end{bmatrix} = 
\begin{bmatrix}
R & t \\
0^T & 1
\end{bmatrix}
\begin{bmatrix}
a \\
1
\end{bmatrix}
= T\begin{bmatrix}
a \\
1
\end{bmatrix}
$$

这样 4x4 的矩阵 T 就描述了坐标系之间的欧式变换，称为变换矩阵

$$
SE(3) = \{ T = \begin{bmatrix}
R & t \\
0^T & 1
\end{bmatrix} \in \mathbb{R}^{4 \times 4} \mid R \in SO(3), t \in \mathbb{R}^3 \}
$$

与 SO(3) 一样， 求解该矩阵的逆表示一个反向的变换

$$
T = \begin{bmatrix}
R^T & -R^Tt \\
0^T & 1
\end{bmatrix}
$$

## 旋转向量和欧拉角

### 旋转向量

上面的变换矩阵来描述6自由度的三维刚体运动有几个缺点

1. SO(3) 的旋转矩阵有9个量，但一次旋转之后只有3个自由度，所以需要9个量来描述6个自由度的刚体运动，同理变换矩阵用16个量表达了6自由度的变换，是否有更紧凑的表示
2. 旋转矩阵自身带有约束，他必须是一个正交矩阵且行列式为1，想要估计或优化一个旋转矩阵/变换矩阵时，这些约束会使求解变得更困难

由之前的外积可以一个旋转都可以用一个旋转轴和一个旋转角来刻画，这种向量称为旋转向量（或轴角）

对于变换矩阵，可以使用一个旋转向量和一个平移向量即可表达一次变换，这时的维度正好是六维

假设有一个旋转轴为 nn，旋转角度为 $\theta$, 它对应的旋转向量为 $\theta n$, 从旋转向量到旋转矩阵的变换过程由 罗德里格斯公式表明

$$
R = cos\theta I + (1-cos\theta)nn^T + sin\theta[n^T \times]
$$

也可以计算一个旋转矩阵到一个旋转向量的转换，对于转角 $$