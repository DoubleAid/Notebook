# torch.Conv2d 参数解释

nn.Conv2d 是 PyTorch 中二维卷积层的核心定义，专门用于图像 / 张量的空间特征提取

## 参数总览 （按顺序 + 关键字）

先明确 `nn.Conv2d` 的核心参数格式

| 参数名 | 核心作用 |
| ---- | ---- |
| in_channels | 输入张量的通道数（如RGB图像的3通道） |
| out_channels | 输出张量的通道数（卷积核的数量，决定提取多少种特征） |
| kernel_size | 卷积核的尺寸（3x3的正方形卷积核） |
| padding | 输入张量边缘的填充数（补 1 圈 0，保持输出尺寸和输入成整数倍关系）|
| bias | 是否给卷积层加偏置项（关闭， 因为后续会接BatchNorm，偏置无意义）|

## 逐个参数详解（结合车道线识别场景）

### in_channels (输入通道数)

+ 定义：输入张量的通道维度数量，对应 PyTorch 张量的shape[1]（通道优先格式）。
+ 车道线场景：输入是 RGB 彩色图像（3 通道），因此设为 3；如果是灰度图（如车道线预处理后的单通道图），则设为 1。
+ 关键注意：必须和输入张量的通道数完全一致，否则会报维度不匹配错误（比如输入是 3 通道却设为 1，或反之）。

### out_channels （输出通道数）

+ 定义：卷积层的卷积核数量，每个卷积核提取一种空间特征，输出张量的通道数等于卷积核数量。
+ 车道线场景：设为 16 是轻量化设计（标准 U-Net 常用 64），车道线识别不需要过多特征，16 个卷积核足够提取边缘、纹理等核心特征；
+ 通俗理解：每个卷积核是一个 “特征检测器”，16 个卷积核就是 16 个不同的检测器（比如有的检测竖线、有的检测斜线，对应车道线的不同方向）。

### kernel_size （卷积核尺寸）

+ 定义：卷积核的空间尺寸，3等价于(3,3)（3×3 的正方形卷积核），是 CNN 中最常用的尺寸。
+ 车道线场景：
    + 3×3 卷积核是 “最小的能捕捉空间上下文的核”，既能提取车道线的局部特征（如像素邻域的梯度），又不会引入过多参数（3×3×3×16=432 个参数，远少于 5×5 的 1200 个）；
    + 若用 1×1 卷积核，仅做通道融合，无法提取空间特征；若用 7×7，参数过多易过拟合（车道线数据集通常不大）

### stride=2（步长）

+ 定义：卷积核在输入张量的高度 / 宽度方向上的滑动步长，2等价于(2,2)（横竖方向都走 2 步）。
+ 核心作用：
    + 下采样：步长 > 1 时，输出张量的尺寸会缩小，实现 “降维 + 特征聚合”；
    + 计算公式（无 padding 时）：输出尺寸 = (输入尺寸 - kernel_size) /stride + 1；
+ 车道线场景：
    + stride=2让输出尺寸变为输入的 1/2（比如 640×480→320×240），减少计算量，同时聚合车道线的全局特征；
    + 是 U-Net 编码器（下采样）的核心操作，和 MaxPool2d 作用类似，但卷积 + 步长下采样能保留更多语义信息（MaxPool 仅取最大值，易丢失车道线细节）。

### padding=1（填充）

+ 定义：在输入张量的边缘填充 0 的层数，1等价于(1,1)（上下左右各补 1 圈 0）。
+ 核心作用：
    + 保持尺寸匹配：抵消卷积核和步长带来的尺寸缩小，让输出尺寸和输入尺寸成整数倍；
    + 计算公式（有 padding 时）：输出尺寸 = (输入尺寸 + 2×padding - kernel_size) /stride + 1；
+ 车道线场景：
    + 输入尺寸为 H×W，padding=1+kernel_size=3+stride=2时，输出尺寸 = (H + 2×1 - 3)/2 + 1 = H/2（整数倍），比如 640→320、480→240，完美下采样；
    + 避免边缘信息丢失：车道线常出现在图像边缘（如左右车道），padding 能让卷积核覆盖到边缘像素，不会漏掉车道线特征。

### bias（偏置项）

+ 定义：是否为每个输出通道添加一个可学习的偏置值（一维张量，长度 = out_channels）。
+ 车道线场景：
    + 关闭偏置（False）是因为卷积层后通常接BatchNorm2d（批归一化），而 BatchNorm 的公式中已经包含了偏置项（β），再保留卷积的 bias 会冗余，且增加参数；
    + 若卷积层后无 BatchNorm，建议设为True（默认值），补充特征的偏移量。

## 关键计算：输入→输出尺寸（车道线场景示例）

假设输入是车道线图像张量：shape=(8, 3, 640, 480)（8 张 RGB 图，640×480），经过该卷积层后：

```
输出高度 = (480 + 2×1 - 3) / 2 + 1 = 480/2 = 240
输出宽度 = (640 + 2×1 - 3) / 2 + 1 = 640/2 = 320
输出通道 = 16
输出shape = (8, 16, 240, 320)
```

完美实现 “通道数增加（3→16）、尺寸减半（640×480→320×240）”，符合 U-Net 编码器下采样的需求。