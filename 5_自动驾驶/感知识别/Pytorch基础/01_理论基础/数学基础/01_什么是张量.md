# 什么是张量

在深度学习（如 PyTorch）和机器人感知 / 定位领域，张量（Tensor）是承载数值计算的核心数据结构，可以理解为 “多维数组的数学抽象”，是标量、向量、矩阵的高维扩展，也是 GPU 加速计算的基础载体。

## 一、张量的直观定义（从低维到高维，类比理解）

| 张量阶数 | 通俗名称 | 数学表示 | 感知 / 定位中的物理意义 | 示例（PyTorch 代码）|
| ---- | ---- | ---- | ---- | ---- |
| 0 阶 | 标量（Scalar）| 单个数值 | 传感器的单个测量值（如 IMU 的角速度、点云的反射率）| torch.tensor(3.14) |
| 1 阶 | 向量（Vector）| 一维数组 | 单个点的坐标（如 LiDAR 点云的 X/Y/Z：[1.2, 3.4, 5.6]）、图像的一行像素值	| torch.tensor([1.2, 3.4, 5.6]) |
| 2 阶 | 矩阵（Matrix）| 二维数组 | 图像的单通道像素（如 640×480 的灰度图）、传感器标定的内参矩阵（3×3）| torch.randn(640, 480) |
| 3 阶 | 3 维张量 | 三维数组 | 彩色图像（H×W×C：640×480×3）、单帧 LiDAR 点云（N×3，N 个点的 XYZ 坐标）| torch.randn(640, 480, 3) |
| 4 阶 | 4 维张量 | 四维数组 | 批量图像（B×C×H×W：8×3×640×480，8 张彩色图）、批量点云（B×N×3）| torch.randn(8, 3, 640, 480)|
| 5 阶 | 5 维张量 | 五维数组 | 视频序列（B×T×C×H×W：8×10×3×640×480，8 个视频、每个 10 帧）| torch.randn(8, 10, 3, 640, 480) |

**核心结论**：张量就是 “任意维度的数值数组”，维度数 = 阶数，每个维度对应感知 / 定位中的一个 “维度特征”（如批次、时间、通道、空间坐标）。

## 二、张量的核心特性（工程化关键）

### 1. 数据类型与设备（适配 Mac M4 / 嵌入式 GPU）

**数据类型**： 决定计算精度和内存占用，感知/定位中常用

+ float32（默认）： 平衡精度和速度，适合模型训练/推理
+ float16 (半精度)：CUDA/MPS 加速使用，内存减半，适合嵌入式设备(如 Jetson)
+ int8 (量化)：模型部署时使用，进一步压缩内存，降低算力消耗
+ int32：存储点云索引、聚类ID等离散值

**设备属性**：张量可部署在CPU/GPU（CUDA/MPS）上，这是感知融合实时性的核心

```python
# MAC M4 (MPS)
device = torch.device("mps" if torch.backends.mps.is_available() else "cpu")
tensor = torch.randn(1000, 3).to(device)

# NVIDIA GPU (CUDA)
tensor = torch.randn(1000, 3).cuda()
```

### 2. 形状（Shape）与 变形 （Reshape）

**shape**：描述张量各维度的长度，感知中常需调整形状适配模型输入

```python
# 单帧点云（1000个点。 XYZ）
point_cloud = torch.randn(1000, 3)
print(point_cloud.shape)    # torch.Size([1000, 3])

# 变形为批量点云（1x1000x3）, 适配模型输入
batch_pc = point_cloud.reshape(1, 1000, 3)
```

常用操作：reshape (变形)、squeeze (压缩维度)、unsqueeze（扩展维度）、permute (维度交换，如 HxWxC -> CxHxW)

### 3. 自动求导（Autograd）

张量可跟踪计算过程并自动求导，是深度学习模型训练的核心 （如标定中的参数优化，感知模型的反向传播）

```python
# requires_grad = True, 跟踪梯度
x = torch.tensor([1.0, 2.0], requires_grad=True)
y = x * 2 + 3
y.backward(torch.ones_like(x))      # 反向传播
print(x.grad)                       # 输出梯度，tensor([2., 2.])
```

在定位/标定中，可用于“相机-LiDAR 标定参数的梯度优化” （如通过张量求导调整外参矩阵）

### 4. 并行计算特性

张量是GPU并行计算的最小单元 --- GPU的核心优势是 “单指令多线程（SIMT）”， 可同时对张量的多个元素执行相同操作（如点云的 DBSCAN 邻域计算，图像的卷积操作）

