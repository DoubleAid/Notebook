# 卡尔曼滤波及其扩展

滤波器方法用来在存在不确定信息的情况下，​估计一个动态系统的内部状态​

## 卡尔曼滤波 KF

卡尔曼滤波认为 当前的状态只和前一帧相关，且当前状态和上一帧的状态存在线性关系，如 当前位置 = 前一帧位置 + 速度 x 时间间隔

### 状态方程

$$
x_k = A_kx_{k-1} + B_ku_k + w_k \\
z_k = C_kx_k + v_k \\
$$

### 卡尔曼滤波的五个公式

#### 1. 预测

$$
E_{先验} = A_kE_{k-1}^{后验} + B_ku_k \\
D_{先验} = A_kD^{后验}_{k-1}A_k^T + Q_k \\
$$

#### 2. 更新

$$
取 K = D_{先验}C_k^T(C_kD_{先验}C_k^T + R)^{-1} = \frac {D_{先验}C_k^T} {C_kD_{先验}C_k^T + R} \\
E_{后验} = E_{先验} + K(z_k - C_kE_{先验}) \\
D_{后验} = (I - K C_k)D_{先验} = D_{先验} - K C_kD_{先验}
$$

## 扩展卡尔曼滤波

问题: 机器人的运动涉及角度和旋转，这些都是非线性的

核心问题：标准卡尔曼滤波里的矩阵乘法（如 A * x）无法描述这些复杂的非线性关系。如果我们强行用线性模型去近似非线性系统，误差会非常大，导致滤波结果发散（完全不准）。

扩展卡尔曼滤波​ 就是为了解决非线性问题而生的。它的核心思想非常直观：
如果系统是非线性的，我们就在当前的最佳估计点附近，用切线（线性）来近似这个曲线（非线性）。也就是一阶泰勒展开，也就是雅可比矩阵

### 状态方程

$$
x_k = f(x_{k-1}, u_k, w_k)
$$

+ $x_k$: k时刻的系统状态（我们想要估计的量）。
+ $f$: 非线性的状态转移函数。
+ $u_k$: k时刻的控制输入（已知量）。
+ $w_k$: k时刻的过程噪声，假设为高斯白噪声，$w_k∼N(0,Q_k)$

$$
z_k = h(x_k, v_k)
$$

+ $z_k$： k时刻的测量值。
+ $h$： 非线性的观测函数。
+ $v_k$： k时刻的观测噪声，假设为高斯白噪声，$v_k∼N(0,R_k)$
+ 假设 $w_k$ 和 $v_k$ 相互独立。

由于 f和 h是非线性的，状态和噪声的分布不再是高斯的，并且我们无法像标准KF那样简单地用矩阵传播均值和协方差。

### 扩展卡尔曼滤波的公式推导

我们无法直接计算状态的期望值 $E[f(x_{k−1},u_k,w_k)]$。EKF采取一个简单直接的近似：忽略过程噪声的非线性效应，并围绕最大概率点（即上一时刻的后验估计）进行线性化。

首先将非线性函数 f 在 $x_{k-1}$ 处进行一阶泰勒展开：

$$
x_k \approx f(E_{k-1}^{后验}, u_k, 0) + F_k(x_k-E^{后验}_{k-1}) + w_k
$$

+ $F_k$ 是 f对状态 x 的雅可比矩阵在 $(E_{k-1}^{后验}, u_k , 0) 处的值
$
F_k = \frac {\partial f} {\partial x} |_{E_{k-1}^{后验}, u_k}
$

令 x = x_{k-1}

$$
z_k \approx h(x_{k}^{先验}, 0) + H_k(x_k - x_{k}^{先验}) + v_k
$$

### 扩展卡尔曼滤波的五个公式

