# 手眼标定

## 什么是手眼标定

简单来说，手眼标定就是确定机器人“手” 和 安装在它上面的“眼睛”之间的坐标转换关系

通过这个坐标关系可以确定：当相机看到一个物体在图像中的某个位置时，这个物体相对于机器人底座（或者机器人末端）的实际空间位置在哪里

## 为什么需要手眼标定

没有准确的标定，机器人就是瞎子和断手

+ 眼在手外: 相机固定在一个地方观察机器人。机器人需要知道“我在相机眼里是什么位置”，才能执行“把A处的物品放到B处”这类任务。
+ 眼在手上: 相机装在机器人手臂上随动。机器人需要知道“我看到的物体相对于我的夹爪在哪里”，才能准确地伸手去抓取。

核心目的：建立图像坐标系、相机坐标系、机器人末端坐标系、机器人基座坐标系之间的精确转换关系，让视觉感知能“指挥”机械臂运动

## 两种经典的配置

手眼标定通常有两种基本配置，问题的数学形式略有不同

1. Eye-in-hand
    + 配置：相机固定在机器人手臂的末端，随着机械臂一起移动。
    + 优点：视野随机械臂移动，可以近距离、多角度观察工件。
    + 标定目标：求解相机坐标系到机器人末端坐标系的固定变换矩阵​ X
2. Eye-to-Hand
    + 配置：相机固定在外部一个静止的位置，从远处观察机器人和工作台。
    + 优点：机械臂运动时，相机视野稳定不变，全局监控。
    + 标定目标：求解相机坐标系到机器人基座坐标系的固定变换矩阵​ X

## 核心原理（数学建模）

这是最精彩的部分，这部分以 眼在手上（Eye in Hand）为例

### 坐标系链表

整个系统涉及几个关键坐标系

+ Base：机器人基座坐标系（世界坐标系）
+ End：机器人末端坐标系
+ Cam：相机坐标系
+ Target：标定板坐标系（例如棋盘格）

### 核心方程

当机械臂移动一次，我们可以得到两个变换关系

+ 机器人已知的：从基座到末端的变换 $B_i$（i表示第i次移动）。这是通过机器人控制器读取的各关节读数，是已知量
+ 相机看到的：从相机到标定板的变换 $C_i$。这是通过拍摄标定板图片，用相机标定算法（如张正友法）计算出来的，也是已知量
+ 我们相求的：从末端到相机的固定变换 $X$。这是个未知量，也是我们标定的目标

### 建立方程

从基座到标定板有两条路径，他们必须相等

+ 路径1： Base -> End(通过 $B_i$) -> Cam(通过X) -> Target(通过$C_i$)
+ 路径2： Base -> End(通过 $B_{i+1}$) -> Cam(通过X) -> Target(通过$C_{i+1}$)

这两条路指向的是同一个固定的标定板，因此有

$$
B_i * X * C_i = B_{i+1} * X * C_{i+1}
$$

### 经典手眼标定方程

对上式进行变换，可以得到著名的 $AX=XB$ 方程形式

其中

+ $A = (B_{i+1})^{-1} * B_i$ (两次机器人末端位姿的相对变换)
+ $B = C_{i+1} * (C_i)^{-1}$ (两次相机观察到的标定板的相对变换)

### 如何求解 X

+ 我们让机器人带着相机移动到多个不同位姿（比如15-20个），在每个位姿都拍摄一张标定板的图片。
+ 这样我们就得到了多组 (A_k, B_k)对应关系。
+ 通过数学方法（如Tsai-Lenz方法、Park方法，或使用最小二乘法、SVD分解等数值方法）来求解这个超定方程组，得到最优的 X。

## 关键和难点

+ 精度：机器人运动学模型误差、相机内参标定误差、图像识别误差都会累积传递到 X的求解中。
+ 噪声：所有传感器数据都有噪声，需要鲁棒的算法来优化求解。
+ 配置选择：根据应用场景选择合适的“眼在手”或“眼在外”配置。

手眼标定的本质，是利用机器人的已知运动和相机的同步观察，通过求解“AX=XB”这个矩阵方程，来解出相机与机器人末端之间那个看不见、但永恒不变的刚性变换关系。​ 它是连接视觉世界和物理运动世界的桥梁，是机器人具备“手眼协调”能力的数学基石。