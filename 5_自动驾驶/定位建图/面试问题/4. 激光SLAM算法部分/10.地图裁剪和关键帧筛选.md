# 地图裁剪和关键帧筛选

## 在激光 SLAM 工程实现中，“地图裁剪” 和 “关键帧筛选” 是提升系统实时性的重要手段，请说明两者的核心目的分别是什么？

1. 地图裁剪：激光 SLAM 实时运行时，点云地图会随机器人运动持续累积，导致内存占用激增、后续配准 / 检索的运算量暴增。核心目的是剔除无效点云数据，控制地图规模，保证系统在长时间运行中仍能维持实时性（帧率稳定），同时避免无效数据干扰定位精度。

2. 关键帧筛选：并非所有采集到的激光帧都需要参与后端优化和地图构建（冗余帧会增加优化复杂度）。**核心目的是筛选出 “信息量足够” 的帧作为关键帧，在保证定位建图精度的前提下，减少后端优化的计算量和数据存储量，平衡精度与实时性。

## 关键帧筛选的常用指标（3 个核心 + 1 个补充）

1. 位姿变化量：当前帧与上一关键帧的相对平移距离（如≥0.5 米）或旋转角度（如≥5 度），超过阈值则判定为关键帧。核心逻辑是 “运动足够大时，新帧能提供新的场景信息”。
2. 点云重叠度：通过 ICP/NDT 计算当前帧与上一关键帧的点云重叠率（如≤70%），重叠度过低说明进入新场景，需保留为关键帧；重叠度过高则为冗余帧，直接丢弃。
3. 信息量指标：提取当前帧点云的特征熵、有效点数量（如激光点云有效点数≥80%）等，若信息量低于阈值（如特征熵过小，说明场景无新特征），则不选为关键帧，避免无效帧占用资源。
4. 补充指标：结合传感器状态（如激光雷达扫描完整性、无遮挡），或 IMU 数据稳定性（如无剧烈抖动），进一步筛选出可靠的关键帧。

## 三、地图裁剪的常见策略

1. 基于距离裁剪：只保留机器人当前位姿周围一定范围内的点云（如 5-10 米），超出范围的历史点云直接删除。适用于移动机器人（如扫地机、AGV），场景范围有限且无需全局地图长期保留的场景。
2. 基于关键帧关联裁剪：仅保留与当前关键帧有重叠关系的历史关键帧对应的点云，删除与当前帧无关联、且不再参与后续优化的 “过期” 关键帧点云。常见于后端图优化的激光 SLAM（如 Cartographer），兼顾全局一致性与内存控制。
3. 基于点云有效性裁剪：剔除无效点（如激光雷达的远距离噪声点、地面点（若无需构建地面地图）、动态物体点（如行人、车辆）），仅保留静态环境的有效点云，减少地图冗余。
4. 分块裁剪：将全局地图划分为固定大小的网格块，仅加载当前机器人所在网格及相邻网格的点云，未加载的网格块存储在硬盘中，需要时再加载。适用于大范围场景（如室外园区），避免一次性加载全量地图占用过多内存。