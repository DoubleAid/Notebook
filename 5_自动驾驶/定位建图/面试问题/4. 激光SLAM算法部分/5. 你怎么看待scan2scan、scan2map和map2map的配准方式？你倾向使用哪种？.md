# scan2scan、scan2map、map2map 配准方式

scan2scan、scan2map、map2map 是激光 SLAM 中三类核心配准范式，其本质差异在于 **配准的 “数据对象” 和 “约束范围”** —— 分别对应 **“帧间局部约束”“帧 - 图全局约束”“图 - 图全局约束”**，适用于 SLAM 不同阶段（前端里程计、后端优化、回环检测），无绝对优劣，需根据场景、精度需求和实时性要求选型。以下从 核心原理、优缺点、适用场景 三方面深度解析，并给出工程化选型建议：

## 一、三类配准方式的核心解析

### 1. scan2scan：帧间配准（当前帧 ↔ 前一帧 / 最近帧）

+ 核心定义：将当前激光扫描帧（scan）与紧邻的历史扫描帧（如前一帧、前 3 帧）直接配准，通过最小化两帧点云的距离误差，得到相邻帧的相对位姿。

+ 典型实现：
  + 特征匹配类：LOAM 的边缘点 - 边缘线、平面点 - 平面配准；
  + 直接配准类：ICP（点到点 / 点到平面）、NDT（正态分布变换）；
+ 数学模型：优化目标为两帧点云的残差和：$\min_{T} \sum_{i} \| T \cdot p_i - q_i \|^2$（$p_i$ 为当前帧点，$q_i$ 为历史帧点，T 为相对位姿）。

### 2. scan2map：帧 - 图配准（当前帧 ↔ 全局 / 局部地图）

+ 核心定义：将当前激光扫描帧（scan）与已构建的全局地图或局部子图（map）进行配准，利用地图的全局几何约束修正当前帧位姿，减少累积漂移。
+ 典型实现：
  + 全局地图配准：Cartographer 前端将当前帧与局部子图配准；
  + 局部地图配准：ORB-SLAM3 激光模块将当前帧与滑动窗口内的地图点配准；数学模型：优化目标为当前帧点与地图点的残差和：$\min_{T} \sum_{i} \| T \cdot p_i - m_i \|^2$（$m_i$ 为地图中的点，T 为当前帧在地图坐标系下的绝对位姿）。

### 3. map2map：图 - 图配准（当前子图 ↔ 历史子图 / 全局地图）

+ 核心定义：将当前构建的局部子图（submap）与历史子图或全局地图（map）进行配准，通过子图间的全局一致性约束，修正子图位姿，解决累积漂移和回环问题。
+ 典型实现：
  + 回环检测配准：Cartographer 后端子图间闭环配准、LIO-SAM 回环时的子图匹配；
  + 地图拼接配准：离线三维重建中多段点云地图的拼接；
+ 数学模型：优化目标为两子图点云的残差和：$\min_{T} \sum_{i} \| T \cdot s_i - t_i \|^2$（$s_i$ 为当前子图点，$t_i$ 为历史子图点，T 为两子图间的变换矩阵）。

## 二、三类配准方式的优缺点对比

| 配准方式 | 核心优势| 关键劣势 | 实时性 | 精度等级 | 核心作用 |
| ---- | ---- | ---- | ---- | ---- | ---- |
| scan2scan | 1. 计算量小（仅两帧点云，数据量少）；<br> 2. 无地图依赖，响应快；<br>3. 适配高速运动（帧间时间差小，运动畸变小）| 1. 仅依赖局部约束，累积漂移严重；<br>2. 对帧间重叠度敏感（重叠 < 30% 易失效）；<br>3. 无全局一致性，长期运行漂移大 | 极高（10~100Hz）| 分米级（纯帧间）| SLAM 前端里程计，提供高频局部位姿估计|
| scan2map | 1. 利用地图全局约束，漂移远小于 scan2scan；<br>2. 地图点云更稠密，配准稳定性强；<br>3. 对帧间重叠度要求低（依赖地图覆盖）| 1. 计算量中等（地图点云数据量大于单帧）；<br>2. 地图更新需同步，对硬件有一定要求；<br>3. 地图初始误差会传递到当前帧 | 高（10~20Hz）| 厘米～分米级 | 前端位姿优化、建图时帧位姿修正，平衡实时性和精度|
| map2map | 1. 全局约束最强，彻底修正累积漂移；<br>2. 子图配准鲁棒性高（子图点云更完整，特征更丰富）；<br>3. 是回环检测的核心，保障地图全局一致性 | 1. 计算量最大（子图数据量大，配准复杂度高）；<br>2. 实时性差（通常低频运行，如 1~5Hz）；<br>3. 依赖子图质量，子图构建不当会导致配准失效 | 中（1~5Hz）| 厘米级 | SLAM 后端优化、回环检测、地图拼接，保证全局一致性

## 三、核心差异：约束范围与误差传递逻辑

### 1. 约束范围：局部 vs 全局

+ scan2scan：仅考虑 “当前帧 - 前一帧” 的局部几何关系，相当于 “盲人摸象”，只关注眼前的局部信息，无法感知全局位置，因此漂移会持续累积。
+ scan2map：考虑 “当前帧 - 全局地图” 的关系，相当于 “拿着地图找位置”，利用已有的全局信息修正当前位置，漂移被地图约束抑制，但地图本身的初始误差会影响当前帧。
+ map2map：考虑 “当前子图 - 历史子图” 的全局关系，相当于 “用两张局部地图拼接全局”，通过子图间的重叠约束修正所有子图的位姿，从根源上消除累积漂移。

### 2. 误差传递逻辑

+ scan2scan：误差单向传递（前一帧误差 → 当前帧 → 下一帧），漂移呈线性增长；
+ scan2scan+scan2map：形成局部闭环（当前帧 → 地图 → 修正当前帧），漂移被地图吸收，增长缓慢；
+ map2map：形成全局闭环（当前子图 ↔ 历史子图），误差反向传播（修正历史子图位姿），全局漂移被清零。

## 四、工程化选型建议：无 “最优”，但有 “最适配”

三类配准方式并非互斥，而是 SLAM 系统的不同模块的核心组件，工程中通常组合使用。但针对特定场景的单一需求，可优先选择对应配准方式：

### 1. 优先选 scan2scan 的场景

+ 核心需求：实时性优先，精度要求低，适配高速运动；
+ 典型场景：
  + 激光 SLAM 前端里程计（如 LOAM 的前端帧间配准），提供 100Hz 高频位姿；
  + 无地图的实时定位（如 AGV 短距离导航），仅需帧间相对位姿；
+ 选型理由：计算量最小，能满足高速运动场景的实时性要求，即使有漂移，可通过后端 scan2map/map2map 修正。

### 2. 优先选 scan2map 的场景

+ 核心需求：平衡实时性和精度，抑制局部漂移；
+ 典型场景：
  + 中低速 SLAM 前端优化（如 Cartographer 前端子图配准），10~20Hz 位姿输出；
  + 基于先验地图的定位（如 AMCL 结合 scan2map 修正位姿）；
+ 选型理由：利用地图的全局约束，漂移远小于 scan2scan，同时计算量可控，能满足中低速场景的实时性要求。

### 3. 优先选 map2map 的场景

+ 核心需求：精度优先，全局一致性要求高，允许低频处理；
+ 典型场景：
  + SLAM 后端回环检测（如 LIO-SAM、Cartographer 的闭环配准）；
  + 离线点云地图拼接（如多段激光扫描数据融合）；
  + 大规模场景建图（如城市级、园区级 SLAM）；
+ 选型理由：全局约束最强，能彻底修正累积漂移，保证地图全局一致性，是高精度建图的核心。

### 4. 工业界主流组合方案

+ 方案 1：scan2scan（前端）+ scan2map（前端优化）+ map2map（后端回环）
  + 例：Cartographer、LIO-SAM、FAST-LIO3 + 回环模块
  + 逻辑：scan2scan 提供高频初值 → scan2map 修正局部漂移 → map2map 解决全局漂移，兼顾实时性和精度。
+ 方案 2：scan2map（前端）+ map2map（后端）
  + 例：NDT SLAM、Karto SLAM
  + 逻辑：简化前端，直接用 scan2map 得到较精确的位姿，后端用 map2map 修正全局漂移，适合中低速、中精度场景。
+ 方案 3：scan2scan（前端）+ map2map（后端）
  + 例：LOAM 原始版本
  + 逻辑：前端 scan2scan 高频输出，后端 map2map（建图阶段的全局配准）修正漂移，适合低速、高精度场景。
  
## 五、总结：我的倾向与核心观点

没有绝对 “倾向” 的单一配准方式，但工程化落地中，“scan2scan + scan2map + map2map” 的组合是最优解—— 三类配准方式各司其职，构成 “高频初值→局部修正→全局闭环” 的完整链路，既能满足实时性要求，又能保证地图全局一致性。

若必须选择一种 “最核心” 的配准方式，我会倾向 map2map—— 因为它是解决 SLAM 核心痛点（累积漂移）的关键，没有 map2map 的全局闭环，scan2scan 和 scan2map 只能抑制漂移，无法彻底消除，长期运行后地图会严重失真。而有了 map2map，即使前端配准精度一般，也能通过后端子图配准修正全局误差，是高精度、大规模 SLAM 系统的 “压舱石”。

但最终选型需回归场景：

+ 高速实时场景（如无人机、高速车辆）：scan2scan 是前端必选；
+ 中低速中精度场景（如园区 AGV）：scan2map 可作为核心；
+ 高精度大规模场景（如自动驾驶、城市建图）：map2map 是后端核心，缺一不可。
