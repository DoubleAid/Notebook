# 视觉残差的构建

## 特征点法的残差构建（主流方案）

特征点法的残差围绕 “3D 点投影到图像平面的 2D 像素误差” 构建，核心分为 2D-2D 对极残差 和 3D-2D 投影残差 两类

### 1. 2D-2D 对极残差（相邻帧运动估计，无深度信息）

适用场景：单目视觉里程计相邻帧位姿初始化，通过匹配的 2D 特征点对求解本质矩阵 E

#### 核心模型

对匹配点对 \(p_1\)（前帧特征点）、\(p_2\)（当前帧特征点），满足：
$$
p_2^T \cdot E \cdot p_1 = 0
$$
其中 $E = t^\land R$（t 为平移向量，R 为旋转矩阵，$t^\land$ 为平移的反对称矩阵）。

#### 残差构建

$r_{epipolar} = p_2^T \cdot E \cdot p_1$

优化目标：最小化 $\sum r_{epipolar}^2$，求解最优的 R 和 t

### 3D-2D 投影残差

适用场景：双目 / RGB-D 视觉里程计、单目三角化后，已知 3D 空间点，求解相机位姿。

#### 残差构建

残差定义为 “投影预测像素” 与 “实际观测像素” 的欧式距离：

$$
r_{proj} = \begin{bmatrix} u_{pred} - u_{obs} \\ v_{pred} - v_{obs} \end{bmatrix}
$$

优化目标：最小化 $\sum r_{proj}^T \cdot W \cdot r_{proj}$（W 为权重矩阵，可设为单位矩阵或根据特征点可靠性加权）。

## 直接法的残差构建（无特征，像素特征化）

直接法的残差围绕 “光度一致性假设” 构建，核心是 “参考帧像素灰度” 与 “当前帧投影像素灰度” 的差值，无需特征提取。

### 工程优化（提升鲁棒性）

+ 灰度归一化：对图像进行直方图均衡化或归一化，减少光照变化对残差的影响；
+ 图像金字塔分层优化：从金字塔顶层（低分辨率）到底层（高分辨率）逐步优化残差，避免陷入局部最优；
+ 考虑相机运动的残差加权：对运动剧烈区域的像素赋予更低权重，降低运动模糊的影响。
