# VINS 光流法计算流程

## 一句话回答

VINS 中光流法的核心流程是：

角点特征选取→前向 LK 光流跟踪→后向验证剔除外点→构建像素位移残差→融入视觉 - IMU 联合优化→特征点动态维护。

光流的作用是补充特征点法的短板，在低纹理、遮挡场景下提供稳定的运动约束，提升系统的鲁棒性。

面试加分细节

+ 光流与特征点法的区别：特征点法依赖描述子匹配（适用于大位移），光流法依赖灰度一致性（适用于小位移），VINS 中两者互补；
+ 工程优化技巧：采用图像金字塔分层跟踪（从顶层到底层），解决大位移场景下的小运动假设失效问题；
+ 与 IMU 的协同作用：IMU 预积分预测的位姿可缩小光流搜索窗口，提升跟踪速度和精度。

## 详细流程

VINS（Visual-Inertial Navigation System）中的光流法主要用于补充特征点法的不足

在特征点缺失 / 匹配失效的场景下，提供像素级的运动约束，同时辅助优化相机位姿和特征点深度，提升系统鲁棒性。

VINS 中常用稀疏光流（如 KLT 光流）

依靠两个假设

1. 光度一致性：同一像素在相邻帧中的灰度值不变；
2. 小运动假设：相邻帧间相机运动较小，像素位移在邻域范围内。

## 步骤 1：特征点选取与跟踪初始化

## 步骤 2：前向 - 后向光流跟踪（双向验证）

为了避免光流跟踪的误匹配，VINS 采用前向跟踪 + 后向重投影验证的策略，以相邻帧 \(I_k\)（当前帧）和 \(I_{k+1}\)（下一帧）为例

1. 前向光流跟踪
    + 对前一帧中的特征点，在当前帧中以t投影点为中心设置搜索窗口（如 21×21 像素）；
    + 利用Lucas-Kanade（LK）算法最小化邻域灰度误差

2. 后向重投影验证
    + 将 $I_{k+1}$ 中的 $p_{k+1}$ 反向跟踪回 $I_k$，得到对应点 $\hat{p}_k$；

## 步骤 3：光流残差构建（融入 VINS 优化框架）
