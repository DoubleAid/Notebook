# ORB特征提取流程

## 一句话回答

ORB 特征提取流程核心是 “建金字塔（尺度不变）→ FAST 角点检测 + NMS（提关键点）→ 灰度质心法赋方向（旋转不变）→ 旋转 BRIEF 生成二进制描述子（高效匹配）”，兼顾速度与鲁棒性，是 ORB-SLAM 等实时视觉 SLAM 的首选特征。

## 详细流程

### 图像金字塔构建（解决尺度不变性）

1. 对原始图像进行高斯模糊和降采样（通常下采样因子为 2），生成不同分辨率的图像层；
2. 每层图像的尺寸为上一层的 \(1/2\)，最终形成从下到上分辨率逐渐降低的金字塔结构；
3. 后续角点检测会在金字塔的每一层独立进行，确保在不同尺度下都能提取到稳定的特征点。

### FAST 角点检测与筛选（提取关键点）

1. FAST 角点检测
    + 遍历图像金字塔每层的每个像素 p，以 p 为圆心、3 像素为半径画圆，选取圆周上的 16 个像素点；
    + 若圆周上存在连续 9 个像素的灰度值都大于 p 的灰度值加阈值，或都小于 p 的灰度值减阈值，则判定 p 为 FAST 角点；
2. 非极大值抑制（NMS）
    + 计算每个 FAST 角点的响应值（圆周像素与中心像素的灰度差之和）；
    + 对响应值做局部极大值筛选，剔除邻域内响应值更低的角点，避免特征点聚集，保证关键点的均匀分布。

### 关键点方向分配（解决旋转不变性）

ORB 通过灰度质心法为每个关键点分配主方向

1. 以关键点为中心，选取一个 31×31 的邻域窗口；
2. 计算邻域内的灰度质心：质心坐标是邻域内像素位置的加权平均，权重为该像素与中心像素的灰度差；
3. 计算关键点到质心的向量方向，将该方向作为关键点的主方向，从而实现旋转不变性。

### BRIEF 描述子改进与生成

1. 根据上一步得到的关键点主方向，对随机像素对集合进行旋转变换，使描述子跟随关键点方向旋转；
2. 预定义 256 对像素对（固定集合，保证重复性），在旋转后的邻域内比较每对像素的灰度值：若前者灰度值大于后者，记为 1，否则记为 0；
3. 生成最终描述子
