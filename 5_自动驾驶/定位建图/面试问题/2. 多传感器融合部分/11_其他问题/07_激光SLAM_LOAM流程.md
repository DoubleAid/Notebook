# LOAM 的流程

LOAM 的输入是原始激光点云（无 IMU 辅助），输出是机器人位姿与全局点云地图，核心流程分为 “点云预处理→特征提取→帧间配准（里程计）→地图优化（建图）” 四步。

## 1. 点云预处

运动畸变去除激光雷达是逐点扫描的，机器人运动会导致同一帧点云内不同点的采集时刻位姿不同，产生 “拖影” 畸变。

LOAM 的去畸变方法

+ 假设机器人在一帧点云扫描周期内做匀速运动（无 IMU 时的近似假设）；
+ 用前一帧的里程计位姿，估计当前帧内每个点的采集时刻位姿；
+ 将所有点云投影到帧末时刻的坐标系下，完成去畸变。

局限性：匀速运动假设在高动态场景下不成立，会导致去畸变不彻底，影响后续配准精度。

## 2. 特征提取

边缘点 + 平面点LOAM 是首个提出激光特征提取 + 特征配准的算法，后续 FAST-LIO 等算法均沿用此思路。特征提取的核心是基于点云曲率筛选：

+ （1） 曲率计算对每个激光点 \(p_i\)，计算其在同一扫描线邻域内的曲率：\(c_i = \frac{1}{N}\sum_{j\in\mathcal{N}(i)} \|p_j - \bar{p}\|^2\)\(\mathcal{N}(i)\)：同一扫描线内 \(p_i\) 的前后 5~10 个邻域点；\(\bar{p}\)：邻域点的均值。
+ （2） 特征筛选特征类型曲率特征物理意义配准作用边缘点高曲率（\(c_i > c_{high}\)）局部邻域凹凸变化剧烈，对应物体边缘（墙角、栏杆）构建点到线约束平面点低曲率（\(c_i < c_{low}\)）局部邻域近似共面，对应墙面、地面构建点到平面约束工程优化：每帧提取约 200 个边缘点 + 200 个平面点，避免特征点过多导致计算量增大。

## 3. 激光里程计线程：帧间特征配准（高频）

这一步的目标是估计相邻两帧激光点云的相对位姿，实现实时里程计：

1. 初始位姿估计：用上一帧的里程计位姿作为初始值；
2. 特征匹配：将当前帧的边缘点 / 平面点，与上一帧的特征点进行匹配；
3. 最小二乘优化：构建点到线 + 点到平面的联合残差，通过高斯 - 牛顿法优化相对位姿：
    + 边缘点残差：当前边缘点到上一帧边缘线的垂直距离；
    + 平面点残差：当前平面点到上一帧平面的垂直距离；
4. 输出里程计位姿：优化后的相对位姿叠加到全局位姿，得到实时定位结果。

## 4. 激光建图线程：全局地图优化（低频）

这一步的目标是用全局地图约束里程计位姿，降低累积漂移：

    + 全局地图维护：将里程计输出的关键帧点云（去畸变 + 特征提取后）插入全局地图；
    + 地图配准：将当前帧的特征点与全局地图中的特征点进行匹配，构建残差；
    + 位姿优化：优化当前帧的全局位姿，修正里程计的累积漂移；
    + 地图更新：用优化后的位姿更新全局地图，保证地图的一致性。
