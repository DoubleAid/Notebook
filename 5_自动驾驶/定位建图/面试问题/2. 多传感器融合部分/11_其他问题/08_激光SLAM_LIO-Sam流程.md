# LIO-SAM

LIO-SAM 的输入是 3D 激光点云 + IMU 原始数据，输出是机器人位姿和全局点云地图，核心流程分为 “IMU 预积分 → 激光特征提取与配准 → 因子图构建与优化 → 关键帧管理 → 全局地图更新” 五步。

## 总体流程

### 步骤 1：IMU 预积分（核心：构建 IMU 因子）

这是 LIO-SAM 与纯激光 SLAM 的核心区别，IMU 不再是辅助去畸变工具，而是提供独立的位姿约束因子。

+ IMU 数据预处理：去除 IMU 零偏和噪声，得到纯净的角速度和线加速度；
+ 预积分计算：在相邻激光帧之间，对 IMU 数据进行预积分，得到相对位姿（旋转 + 平移）、速度变化和零偏估计，同时计算预积分的协方差矩阵（表征 IMU 数据的不确定性）；
+ 预积分因子构建：将 IMU 预积分结果封装为 IMU 因子，包含相对位姿约束和协方差，后续融入因子图优化。

### 步骤 2：激光特征提取与配准（继承 LeGO-LOAM）

LIO-SAM 完全沿用了 LeGO-LOAM 的激光处理流程，保证轻量化特性：

+ 点云分割与地面提取：用 RANSAC 拟合地面平面，分割地面点和非地面点；
+ 特征提取：对非地面点计算曲率，提取 边缘点（高曲率）+ 平面点（低曲率）（各 100 个左右）；
+ 帧间配准：将当前帧特征点与上一帧特征点匹配，构建 点到线 + 点到平面 残差，用高斯 - 牛顿法优化得到激光里程计位姿（作为激光因子的初始值）。

### 步骤 3：因子图构建与优化（核心：紧耦合的关键）

这是 LIO-SAM 的核心环节，通过因子图统一激光约束和 IMU 约束，实现紧耦合融合。

因子图的节点与因子定义

+ 节点：激光关键帧的位姿；因子类型：IMU 
+ 因子：相邻关键帧之间的 IMU 预积分约束，权重由预积分协方差决定；
+ 激光因子：当前关键帧与上一关键帧的激光配准约束，权重由激光配准误差决定；
+ 闭环因子（可选）：回环检测模块提供的全局位姿约束，抑制长航时漂移。

因子图优化

+ 构建联合残差方程：最小化 IMU 因子残差 + 激光因子残差 + 闭环因子残差；
+ 用 g2o/Ceres 求解器进行稀疏优化，得到最优的关键帧位姿；
+ 优化结果直接修正激光里程计的位姿，消除累积漂移。

### 步骤 4：关键帧管理（轻量化核心）

LIO-SAM 采用关键帧驱动的策略，进一步降低计算量：

+ 关键帧筛选条件：只有当机器人满足以下任一条件时，才生成关键帧：
  + 平移距离超过阈值（如 0.5m）；
  + 旋转角度超过阈值（如 5°）；
  + 距离上一个关键帧的时间超过阈值（如 2s）；
+ 非关键帧位姿插值：非关键帧的位姿由前后关键帧的位姿和 IMU 预积分插值得到，无需参与优化；
+ 滑动窗口优化：只维护最近的 N 个关键帧（如 20 个），避免因子图规模过大，保证实时性。

### 步骤 5：全局地图更新与回环检测

地图更新：将优化后的关键帧点云（去畸变 + 特征提取后）插入全局地图，用体素滤波降采样，避免地图膨胀；

回环检测（可选）：用 KD-Tree 搜索当前关键帧与历史关键帧的特征匹配，计算相对位姿约束，作为闭环因子融入因子图优化，进一步抑制长航时漂移。

## LIO-SAM 的紧耦合特性（与纯激光 SLAM 的区别）

LIO-SAM 被称为紧耦合，核心是因为它满足紧耦合的判定标准：激光和 IMU 的观测约束在同一个优化框架内融合，共享同一个位姿状态量。

与纯激光 SLAM（LOAM/LeGO-LOAM）的区别如下：

+ 传感器融合：LOAM 无 IMU，纯激光配准，LIO-SAM 激光因子 + IMU 因子融合优化
+ 位姿估计: LOAM 仅依赖激光帧间配准, LIO-SAM 激光约束 + IMU 预积分约束 双保障
+ 高动态适配: LOAM弱（匀速假设易失效）, LIO-SAM 强（IMU 高频预测弥补激光帧率低）
+ 弱特征场景: LOAM 易丢帧（如空旷走廊）, LIO-SAM鲁棒（IMU 约束维持定位）
+ 漂移抑制: LOAM 依赖低频全局配准, LIO-SAM 激光 + IMU + 闭环 三重抑制

## LIO-SAM 与 FAST-LIO 的核心区别（面试高频考点）

两者都是激光 - IMU 紧耦合算法，但框架和适用场景差异显著：

| 对比维度  | LIO-SAM | FAST-LIO（v2/v3）|
| ---- | ---- | ---- |
| 核心框架 | 因子图优化 | iEKF |
| 滤波状态量 | 仅优化关键帧位姿 | 优化 15 维状态量（位置 / 姿态 / 速度 / IMU 零偏） |
| 融合粒度 | 关键帧级融合（低频）| 逐帧迭代融合（高频） |
| 高动态适配 | 中（适合地面机器人） | 强（适合无人机 / 高速车载） |
| 算力消耗 | 低（嵌入式实时） | 中（需 GPU 加速提升实时性） |
| 地图构建 | 全局稀疏地图 | 局部稠密地图 |
| 扩展性 | 易扩展回环检测 / 语义融合 | 易扩展多雷达 / 视觉融合 |

## LIO-SAM 的核心优势与局限性

1. 核心优势

+ 轻量化：继承 LeGO-LOAM 的特征提取和关键帧策略，算力消耗低，适配嵌入式平台；
+ 鲁棒性强：IMU 预积分弥补激光短板，高动态、弱特征场景下不易丢帧；
+ 工程化友好：开源代码成熟，支持 ROS 快速部署，配套标定工具完善；
+ 可扩展性高：可轻松接入回环检测、语义分割、GNSS 等模块。

2. 局限性

+ 高动态场景适配弱于 FAST-LIO：因子图是关键帧级优化，无法像 iEKF 那样逐帧迭代修正；
+ 依赖地面约束：继承 LeGO-LOAM 的地面提取逻辑，非地面机器人（如无人机）适配性差；
+ IMU 零偏估计能力弱：未将 IMU 零偏作为优化状态量（部分改进版已支持）。

## 面试核心总结话术

LIO-SAM 是激光 - IMU 紧耦合的轻量化标杆算法，核心是 “LeGO-LOAM 激光里程计 + IMU 预积分因子 + 因子图优化” 的融合框架：它将 IMU 预积分作为约束因子融入因子图，与激光配准因子联合优化关键帧位姿，兼顾了精度和实时性。与纯激光 SLAM 相比，它在高动态、弱特征场景下鲁棒性更强；与 FAST-LIO 相比，它更轻量化，适合地面移动机器人。其紧耦合的核心是激光和 IMU 约束在同一个因子图框架内融合，共享关键帧位姿状态量。