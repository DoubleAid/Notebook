# 视觉回环 如何避免误匹配

## 一句话回答

粗匹配阶段

1. 时空窗口约束：限定时间阈值和里程计位姿距离阈值，过滤较远的历史帧，避免相似但非回环的场景干扰
2. 特征相似度阈值调整：对于局部特征BoW还是全局描述子，合理修改相似度阈值，过滤低相似度
3. 避免低质量图像：移除过滤动态模糊/欠曝/过曝后提取的特征点过少的帧，避免低质量图像参与匹配

精匹配阶段

1. 局部特征几何验证
    + 对匹配的特征点对，用RANSAC求解基础矩阵/单应矩阵，过滤外点，要求内点占比 > 30%
    + 验证极线约束、重投影误差，确保特征匹配的几何一致性
2. 若使用深度学习等，可以调整匹配置信度的阈值

验证校验阶段

1. 时空一致性校验：要求连续2-3帧均检测到同一候选回环，且满足时空约束，避免单帧偶然匹配
2. 位姿图一致性校验/重投影残差校验：
    + 将回环约束加入位姿图优化，若优化后全局残差收敛，且单个约束残差 < 阈值，则验证有效
    + 用优化后的位姿将当前帧特征点重投影到候选帧，要求重投影误差分布均匀且整体偏小
3. 语义一致性校验（可选）：对比候选帧和当前帧的语义类别分布（如车道线，建筑物占比），若语义差异过大，认为为误匹配
