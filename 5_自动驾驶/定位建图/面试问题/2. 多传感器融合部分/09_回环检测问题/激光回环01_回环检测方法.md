# 激光雷达 回环检测方法

## 一句化回答

激光雷达回环检测核心是 "识别已遍历场景，修正累积漂移"，分成三个部分：粗检测 + 精检测 + 验证检查，主流分成三大类：

+ 1.位姿粗检索 + 局部子图经匹配
  + 先通过位姿距离筛选历史关键帧中附近的候选帧，后见局部子图；
  + 精配准通过点云直接匹配（ICP， NDT）配准，通过配准残差判断是否回环
+ 2.局部描述子检索 + 配准验证
  + 提取当前帧的ISS特征点和FPFH描述子，通过BoW检索得到候选帧
  + 再通过点云匹配或特征匹配计算相似度，结合配准残差判断是否回环
+ 3.全局描述子检索 + 配准验证
  + 提取历史关键帧的全局点云描述子（如 scan-context、loam-context），通过相似度排序帅选候选环；
  + 再使用ICP，NDT做精配准，结合位姿一致性检验（如闭环约束无矛盾），最终确认有效回环

## 粗检测（快速候选检索）

目标：从大量历史关键帧中快速筛选出几个可能的回环候选帧

常见方法：

+ 位姿距离检索：在里程计轨迹上，选择当前位置半径R（如20m）内的历史关键帧作为候选。这是最简单的空间检索，但容易在轨迹交叉处产生误检
+ 全局描述子检索：为每帧点云/地图计算一个全局描述向量，通过描述子相似度快速检索。这是最主流，最鲁棒的方法：
  + Scan-Context：适用于3D激光，对旋转和平移有一定的不变性
  + BoW（词袋模型）：提取局部特征（如FPFH， SHOT）构建视觉词袋，适用于视觉SLAM
  + PointNetVLAD：基于模型的点云描述符，视角不变性强，描述能力强

## 精检测

使用ICP 或 NDT 进行精配准，评估配准质量的因素有：

1. 残差大小：比如残差是否是大于0.3m
2. 位姿变换合理性检查：位置或者姿态变化是否过大，超过了不合理的范围
3. 收敛性：是否最后的残差小于设定的值

使用 特征匹配

1. 内点比例：如果使用特征匹配，需要内点比例检查，如是否大于0.3

## 验证检查

+ 位姿图一致性: 检查新检测的回环是否和已有的位姿图相容， 添加回环检测，判定是否降低整体误差
+ 时序一致性：相邻帧检测的回环应具有时空连续性，比如连续多帧检测到回环
+ 空间聚类检验：有效回环的候选帧应该在空间上聚集，排除孤立误匹配
