# SG函数
**SG函数**是用于解决博弈论中**公平组合游戏**（Impartial Combinatorial Games，**ICG**）问题的一种方法。

所谓ICG，应当满足以下几条性质：
+ 有两名玩家
+ 两名玩家轮流操作，在一个有限集合内任选一个进行操作，改变游戏当前局面
+ 一个局面的合法操作，只取决于游戏局面本身且固定存在，与玩家次序或者任何其它因素无关
+ 无法操作者，即操作集合为空，输掉游戏，另一方获胜


最简单的ICG当然就是经典的Nim游戏了：
```
地上有 n 堆石子，每堆石子数量可能不同，两人轮流操作，每人每次可从任意一堆石子里取走任意多枚石子，可以取完，不能不取，无石子可取者输掉游戏，问是否存在先手必胜的策略。
```

之后我们会多次以Nim游戏举例。

对于ICG，我们定义一个函数 $sg(x)$，令 $sg(x) = mex({sg | x \to y})$ 。其中，x 和 y 都表示某种状态，$x \to y$ 在这里表示$x$状态可以通过一次操作达到 $y$ 状态，$mex$表示一个集合中未出现的最小自然数（例如 $mex({0, 1, 3}) = 2$）。如果 $sg(x) = n$，说明从当前状态可以转移到$sg$为 0, 1, 2, ..., n-1的状态。

我们称令 $sg(x) = 0$ 的状态$x$为必败态。显然，如果$x$是无法操作的状态（即${sg(y)|x \to y} = \phi$ ，在Nim游戏中是没有石子可取的状态），则必有 $sg(x)=0$，这时当前玩家输掉游戏；若不然，则该状态只能转移到 sg 不为 0 的状态，那么对手立刻又可以转移到 sg 为 0 的状态，这样进行有限次后一定会陷入无法操作的状态输掉比赛。

相反，如果 $sg(x) \ne 0$，则称 $x$ 为必胜态，说明此时存在策略使自己必定取胜（即每次轮到自己都转移到 sg 为 0 的状态）。

对于单堆的Nim游戏，我们很容易计算其 sg 值。设 $sg(m)$ 表示剩余石子数为 m 的状态的 $sg$ 值，则显然 $sg(0) = 0$，那么 $sg(1)=1$，$sg(2)=2$ ……归纳可证 $sg(n)=n$。因此，石子数不为0都是必胜态。

对于双堆的Nim游戏，设 $sg(n, m)$ 表示剩余石子数分别为 $n$ 和 $m$ 的状态的 $sg$ 值，则$sg(0, 0) = 0$ ，并且$sg(n, 0) = sg(0, n) = n$ 。我们发现 $sg(1, 1) = 0$，而 $sg(0, 0) = 0$， ……继续探索可以猜测，当 $m=n$时，$sg(m, n) = 0$ ，否则$sg(m, n) \ne 0$。这可以归纳证明。

当堆数越来越多时，这样盲目探索显得很困难。所幸，我们有SG定理。

定义若干个ICG的组合为这样一个游戏：每位玩家每个回合在这若干个ICG（称为子游戏）中选择一个，对它进行一次操作；当所有子游戏都无法进行操作时，当前玩家输掉游戏。记两个ICG的状态分别为
和 ，则记这两个ICG的组合的状态为

。

Sprague-Grundy定理（两个游戏的情形）：

<center>

设 x 和 y 为ICG的状态，则：$sg(x+y) = sg(x) \bigoplus sg(y)$

</center>

其中 $\bigoplus$ 表示异或。

这个定理还是很神奇的，这里就不展开篇幅证明了，这里有很多证明。可以这样感性地理解：如果两个子游戏的
值异或不为 ，那么一定可以转移到一个 值异或和为 的状态（将 值较大者转移到与较小者的 值相同的状态就可以了，这一定能做到）；相反，如果两个子游戏的 值异或为 ，则只能转移到 值异或和不为

的状态——这正好对应了必胜态和必败态。

这个定理很容易进行推广：

    设 

为ICG的状态，则：

利用SG定理，我们就可以轻松地把单一游戏的情况推广到多个子游戏组合的情况。例如Nim游戏，就是在
堆石子的异或和为 时必败，否则必胜。